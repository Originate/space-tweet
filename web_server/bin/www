#!/usr/bin/env lsc

require! {
  '../server/app'
  'http'
  '../server/assets.ls' : asset-server
}
debug = require('debug')('web:server')


server = http.createServer app
server.on 'error', (error) ->
  | error.syscall isnt 'listen'  =>  throw error

  console.error switch error.code
  | 'EACCES'      =>  'Port requires elevated privileges'
  | 'EADDRINUSE'  =>  'Port is already in use'
  | _             =>  error
  process.exit 1

server.on 'listening', ->
  debug "web server online at port #{server.address!port}"


server.listen parse-int(process.env.PORT or '3000')

asset-server.listen 8080, 'localhost', ->
  debug 'asset server online at port 8080'
