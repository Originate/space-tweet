#!/usr/bin/env lsc

require! {
  '../app'
  'http'
}

debug = require('debug')('web_server:server')

server = http.createServer app

bundle = require '../server/bundle.ls'
bundle!

server.on 'error', (error) ->
  | error.syscall isnt 'listen'  =>  throw error

  switch error.code
  | 'EACCES'  =>
      console.error 'Port requires elevated privileges'
      process.exit 1
  | 'EADDRINUSE'  =>
      console.error 'Port is already in use'
      process.exit 1
  | _  => throw error


server.on 'listening', ->
  debug "Listening on port #{server.address!port}"


server.listen parse-int(process.env.PORT or '3000')
