// Generated by LiveScript 1.5.0
(function(){
  var NATS, ref$, each, objToPairs, NatsConnector;
  NATS = require('nats');
  ref$ = require('prelude-ls'), each = ref$.each, objToPairs = ref$.objToPairs;
  NatsConnector = (function(){
    NatsConnector.displayName = 'NatsConnector';
    var prototype = NatsConnector.prototype, constructor = NatsConnector;
    function NatsConnector(){
      this.nats = NATS.connect("nats://" + process.env.NATS_HOST + ":4222");
      console.log("connected to nats");
    }
    NatsConnector.prototype.subscribeMapping = function(messageCallbackMapping){
      var this$ = this;
      return each(function(arg$){
        var name, callback;
        name = arg$[0], callback = arg$[1];
        return this$.nats.subscribe(name, function(request, replyTo){
          return callbak(request.payload, {
            reply: function(payload){
              return this$.nats.publish(replyTo, payload);
            }
          });
        });
      })(
      objToPairs(
      messageCallbackMapping));
    };
    NatsConnector.prototype.send = function(name, data, callback){
      return this.nats.requestOne(name, data, function(response){
        return callback(response.payload);
      });
    };
    return NatsConnector;
  }());
  module.exports = NatsConnector;
}).call(this);
